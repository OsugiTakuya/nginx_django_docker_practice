{% load static %}

<!-- 参考：https://github.com/dmr/jquery.ganttView -->

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>

	<link rel="stylesheet" type="text/css" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
	<link rel="stylesheet" type="text/css" href="{% static 'gantt/jquery.ganttView.css' %}" />
	<style type="text/css">
		body {
			font-family: tahoma, verdana, helvetica;
			font-size: 0.8em;
			padding: 10px;
		}
	</style>
	<title>jQuery Gantt</title>
</head>
<body>

	<div id="ganttChart"></div>
	<br/><br/>
	<div id="eventMessage"></div>

	<p>時刻更新</p>
	{% csrf_token %}
	<input type="button" id="button1" value="butttton">
	<div id="div1"></div>

	<script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.js"></script>
	<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/datejs/1.0/date.min.js"></script>
	<script type="text/javascript" src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
	<script type="text/javascript" src="{% static 'gantt/jquery.ganttView.js' %}"></script>
	<script type="text/javascript">
		var ganttData = [
			{
				id: 1, name: "Feature 1", series: [
					{ name: "Planned", start: new Date(2010,00,01), end: new Date(2010,00,03) },
					{ name: "Actual", start: new Date(2010,00,02), end: new Date(2010,00,05), color: "#f0f0f0" }
				]
			},
			{
				id: 2, name: "Feature 2", series: [
					{ name: "Planned", start: new Date(2010,00,05), end: new Date(2010,00,20) },
					{ name: "Actual", start: new Date(2010,00,06), end: new Date(2010,00,17), color: "#f0f0f0" },
					{ name: "Projected", start: new Date(2010,00,06), end: new Date(2010,00,17), color: "#e0e0e0" }
				]
			},
			{
				id: 3, name: "Feature 3", series: [
					{ name: "Planned", start: new Date(2010,00,11), end: new Date(2010,01,03) },
					{ name: "Actual", start: new Date(2010,00,15), end: new Date(2010,01,03), color: "#f0f0f0" }
				]
			},
			{
				id: 4, name: "Feature 4", series: [
					{ name: "Planned", start: new Date(2010,01,01), end: new Date(2010,01,03) },
					{ name: "Actual", start: new Date(2010,01,01), end: new Date(2010,01,05), color: "#f0f0f0" }
				]
			},
			{
				id: 5, name: "Feature 5", series: [
					{ name: "Planned", start: new Date(2010,02,01), end: new Date(2010,03,20) },
					{ name: "Actual", start: new Date(2010,02,01), end: new Date(2010,03,26), color: "#f0f0f0" }
				]
			},
			{
				id: 6, name: "Feature 6", series: [
					{ name: "Planned", start: new Date(2010,00,05), end: new Date(2010,00,20) },
					{ name: "Actual", start: new Date(2010,00,06), end: new Date(2010,00,17), color: "#f0f0f0" },
					{ name: "Projected", start: new Date(2010,00,06), end: new Date(2010,00,20), color: "#e0e0e0" }
				]
			},
			{
				id: 7, name: "Feature 7", series: [
					{ name: "Planned", start: new Date(2010,00,11), end: new Date(2010,01,03) }
				]
			},
			{
				id: 8, name: "Feature 8", series: [
					{ name: "Planned", start: new Date(2010,01,01), end: new Date(2010,01,03) },
					{ name: "Actual", start: new Date(2010,01,01), end: new Date(2010,01,05), color: "#f0f0f0" }
				]
			}
		];

		$(function () {
			$("#ganttChart").ganttView({
				data: ganttData,
				slideWidth: 900,
				behavior: {
					onClick: function (data) {
						var msg = "You clicked on an event: { start: " + data.start.toString("M/d/yyyy") + ", end: " + data.end.toString("M/d/yyyy") + " }";
						$("#eventMessage").text(msg);
					},
					onResize: function (data) {
						var msg = "You resized an event: { start: " + data.start.toString("M/d/yyyy") + ", end: " + data.end.toString("M/d/yyyy") + " }";
						$("#eventMessage").text(msg);
					},
					onDrag: function (data) {
						var msg = "You dragged an event: { start: " + data.start.toString("M/d/yyyy") + ", end: " + data.end.toString("M/d/yyyy") + " }";
						$("#eventMessage").text(msg);
					}
				}
			});

			// $("#ganttChart").ganttView("setSlideWidth", 600);
		});

		// Ajax準備
		function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        var csrftoken = getCookie('csrftoken');

        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }

        $.ajaxSetup({
            beforeSend: function (xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });

		data_submit = {'disp_time': 1, 'any_data': 400};

		// Ajaxで時刻表示
		$('#button1').click(function(e){
			$.ajax({
				// url: "http://18.183.151.164:9000/clock/getnow",
				url: '{% url "clock:getnow" %}',
				type: "POST",
				data: data_submit,
				dataType: "json",
				timeout: 1000,
				cache: false,
			})
			.done(function(response){
				$('#div1').text(response.now);
			})
			.fail(function(){
				$('#div1').text('error!!!!');
			});
		});
		
	</script>

</body>
</html>